---
title: "Applied Dynamics for Robust Analytics and Adaptive Malaria Control"
author: "David L. Smith and the RAMP Team"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output:
  bookdown::gitbook:
    lib_dir: assets
    split_by: section
    config:
      toolbar:
        position: static
  bookdown::pdf_book:
    keep_tex: yes
    toc: true
    toc_depth: 3
    citation_package: biblatex
    extra_dependencies:
      mathrsfs: null
      caption: null
documentclass: book
bibliography: refs.bib
csl: plos.csl
link-citations: true
---

```{r include=FALSE}
knitr::write_bib(c("knitr", "book"), "", width = 60)

# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')

knitr::opts_chunk$set(echo = FALSE, fig.path = "docs/figs/")

```


# Foreword {-}

A large fraction of my time over the past 20 years has been devoted to learning about malaria and mathematical models of malaria epidemiology, transmission dynamics, mosquito ecology, vector control, and the evolution of drug and insecticide resistance.
All the time I was building and analyzing models, I was looking for a way of organizing, operationalizing, and applying the rich body of theory developed over more than a century of malaria research, starting with Ronald Ross [@RossR1911Book;@SmithDL2012_RossMacdonald].
A new framework would integrate the concepts and models that have influenced malaria through the present day [@ReinerRC2013SystematicReview;@SmithNR2018AgentbasedModels], and it might even serve as a platform for recasting a theory of malaria epidemiology, transmission dynamics, and control [@SmithDL2014Recasting].

After all these years, we have developed a framework that tackles the challenges of using evidence to develop malaria policy. A core part of that framework is the use of malaria simulation models.
Policy discussions can benefit from using mathematics, but discussions must focus on the policy questions, the concepts, and evidence rather than on the mathematics *per se*. 
Ideally, mathematical ideas should give rigor to the analysis help structure policy discussions without becoming the focus of attention, except perhaps when the mathematics draws attention to something that needs to be clarified.
When I set out, I knew that building a framework would face some challenges, but I believed that -- if we could solve those challenges -- then we could make the math easier to use so that discussions would focus on the issues that mattered.
Ideally, the framework could be taken up and used by teams of local experts working in their own countries to reduce the burden of malaria and plan for its elimination.
The same framework could also support the academic activities taken up on the side.

We wanted a nimble framework for model building that was capable of conforming to the problems at hand. It should be *extensible,* with *plug-and-play* modularity (for major dynamical components), with flexibility in the choice of functional forms describing various relationships. The framework should also be structurally flexible, so that a model could incorporate space, time, and population strata.
It should be scalable to handle realism and complexity: it should be possible to scale down spatially for fine-grained spatial simulations [@CarterR2002SpatialSimulation;@GuW2003IndividualbasedModel;@PerkinsTA2013HeterogeneityMixing], to scale down temporally for fine-grained temporal simulations [@WuSL2020MBITES], or to scaling up to understand or analyze regional processes and the emerging patterns [@TatemAJ2010InternationalPopulation].
To serve the needs of malaria programs, a framework would need  built-in support for exogenous forcing by weather and vector control to model malaria as a changing baseline modified by control. 
To get integrated vector control right, we went all in on mosquito ecology with an individual-based simulation model (called MBITES) that could handle exquisite biological detail [@WuSL2020MBITES], which inspired new ideas about simple models based on mosquito search and behaviors.
To get malaria transmission right, we would need to be able to deal with heterogeneity of all sorts.

To serve programmatic needs, we needed algorithms that could address the decay of interventions 
-- coverage could decay over time through loss (*e.g.* bed nets) or waning potency --
and the net effect of one unit of vector control in relation to transmission intensity and coverage.
To make all the pieces fit together, we needed interfaces that could connect up models in a generic way; in the design phase, we worked with two model families for each major dynamical component -- one that was dead simple, and one that had a was highly realistic.
In some cases, the interface designs called for development of new algorithms: blood feeding, egg laying, environmental heterogeneity, human mobility, and mosquito dispersal. 
In making a master list to test the framework's extensibility, we found that some odd cases that needed to pass information among components -- endectocides and auto-disseminated larvicides -- but it was easy enough to accommodate these.
Beyond the algorithms, these models needed the support of mathematical theory.
We wanted the software to help understand thresholds, so we wrote the routines that would compute thresholds for malaria transmission in heterogeneous systems, when appropriate. 

Sometime in the fall of 2022, the last few pieces came together. We published the first versions of [MicroMoB](https://cran.r-project.org/package=MicroMoB) and [exDE](https://CRAN.R-project.org/package=exDE) at CRAN. We submitted a paper to PLoS Computational Biology [@WuSL2023SpatialDynamics]. A second paper forced us to confront a set of software design questions in relation to exogenous forcing **addCite**. 
Then it was time to write this book. 

The software lowers the costs of building models that are up to the task of guiding malaria policy.
An advantage of using this framework and accompanying software is that it has built-in solutions to a large set of problems that arise when building models that combine many factors.
These sorts of pitfalls are inevitable and annoying, and they are usually discovered the hard way.
We found design solutions that would help others building models to avoid these sorts of problems.  The framework took longer than expected, in part, because there were more pitfalls than we had anticipated. 

This book has been written to introduce the features of the mathematical framework and the software (see Figure 1.1). The book is accompanied by the RAMP-Model-Library, which was set up during the primary design phase. The RAMP-Model-Library is where we made all our design mistakes: was the software truly plug-and-play, and was the framework truly extensible? As the primary design phase came to a close, the library that was once the laboratory became a classroom and a museum. The library is being transformed into a resource for any developer who wants to add new base models to the library or add functionality. Most of all, it is being set up for the end user, someone in a malaria program or working with a malaria program who wants to use simulation based analytics to analyze policies. This book is structured into a set of lessons that teach concepts. Some of the concepts build on one another, and others take on new challenges. We combine these lessons into some examples where we show some algorithms to build models fit for purpose. When a topic deserves a deeper dive, we have supplemented this book with vignettes or lessons.  

***
<center> 

![A schematic diagram of the elements in the framework (top half) and the process of model building and model fitting (bottom half)](Figures/ScalableComplexity.png){width=80%}

</center> 
*** 

This book shows, through examples, how to use the software to build malaria models.
Even without the software, it fills a gap for students who have taken an introduction to mathematical epidemiology or infectious disease modeling and want to go on in malaria. 
What are all the special topics that would need to be covered to build models that could be needed in malaria? 
This book *could* be the basis for such a course, if there were ever enough students.
Since there will probably never be enough graduate students at my university who are interested in applied malaria dynamics, the material is being developed for any student anywhere.
I will also be writing and recording some short lectures on a subset of topics.



The premise of this book is thus that the reader has started with a solid background in infectious disease models and malaria. We assume they've seen the Ross-Macdonald model before, that they've taken a class in mathematical epidemiology, and that they know something about how to construct and analyze models. This book emphasizes concepts and teaches through examples. We have left out a lot of the technical and mathemtical details, but we have written some vignettes and lessons to supplement the book. Most of this is found in the documentation for `exDE` or `MicroMoB` or it can be found in the [`RAMP-Model-Library`](../../RAMP-Model-Library/RAMP-Model-Library.html). 

While this book should help others build models for malaria policy, but it stops short of applying models to policy. That is covered in another book, [**_Robust Analytics for Malaria Policy_.**](../../RAMP-Book/_book/index.html){target="_blank"} 

***

In doing all this, we are building on an enormous body of work that started with Ronald Ross. While Ross is better known for identifying malaria parasites in a mosquito gut, which proved that malaria is mosquito transmitted, we are more interested in the rest of his career. 

After winning the Nobel Prize in 1902, Ross was instrumental in building solid quantitative foundations for malaria transmission and its measurement. Ronald Ross wrote the first models describing malaria transmission. In his writings from 1899 to 1911, it's clear that he was searching for quantitative way of saying something simple -- if there are not enough mosquitoes, the malaria transmission can't be sustained. There must be a critical mosquito density, above the cutoff malaria transmission would be sustained, and below it malaria would be eliminated. Ross was looking for a formula that encapsulated his intuition: how were thresholds related to the fact that it took two bites for a mosquito to complete its life cycle? Eventually, Ross wrote down some systems of equations that would describe malaria. The ideas, mathematics, and identification of parameters and processes were extended by other scientists later, most notably Alfred Lotka and George Macdonald. 

It seems that the challenge of malaria control was what pushed Ross toward modeling. Ross's first model was a discussion of adult mosquito movement to guide larval source management [@RossR1905LogicalBasis]. The first model describing malaria transmission appeared in a book, *The Prevention of Malaria in Mauritius* [@RossR1908]. When it came to thinking through control, Ross found it useful to do the math. More than a century later, this book is a look at what his vision has become.  

--David L. Smith

## Contributors {-}

I've done the primary writing for this book. The framework would not exist without the work of Sean L Wu and a few others. The book borrows from the work of others, and we have done our best to give credit through citations. It has been a collaborative process (see [Contributors]). The errors, however, are mostly mine. If you find mistakes or have questions, please drop me a note by email: [smitdave@gmail.com](mailto:smitdave@gmail.com). 

This is a work in progress, so the list of contributors will change over time. 

The software package `MicroMoB` was written by Sean L Wu, Sophie Liebkind, and David L Smith. The software package `exDE` was written by Sean L Wu and David L Smith. 

Most of the content so far was written by David L Smith. Contributors from the RAMP Team include: 

...please consult Dave if you would like a writing role. 
